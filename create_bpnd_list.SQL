CREATE TABLE "PACIENT" (
	"PACIENT_ID"	NUMBER(10),
	"LAST_NAME"		VARCHAR2(30),
	"FIRST_NAME"	VARCHAR2(30),
	"SECOND_NAME"	VARCHAR2(30),
	"DATE_OF_BIRTH" DATE DEFAULT NULL,
	PRIMARY KEY("PACIENT_ID")
);
CREATE SEQUENCE S_PACIENT
START WITH 1
INCREMENT BY 1
CACHE 10;

CREATE OR REPLACE TRIGGER T_PACIENT_ID
BEFORE INSERT
ON PACIENT
REFERENCING NEW AS NEW
FOR EACH ROW
BEGIN
	if(:new.PACIENT_ID is null) then
	SELECT S_PACIENT.nextval
	INTO :new.PACIENT_ID
	FROM dual;
	end if;
END;
/

ALTER TRIGGER "T_PACIENT_ID" ENABLE;

CREATE TABLE "REGION" (
	"REGION_ID"     NUMBER(10),
	"REGION_NAME"   VARCHAR2(40),
	PRIMARY KEY("REGION_ID")
);

CREATE SEQUENCE S_REGION
START WITH 1
INCREMENT BY 1
CACHE 10;

CREATE OR REPLACE TRIGGER T_REGION_ID
BEFORE INSERT
ON REGION
REFERENCING NEW AS NEW
FOR EACH ROW
BEGIN
	if(:new.REGION_ID is null) then
	SELECT S_REGION.nextval
	INTO :new.REGION_ID
	FROM dual;
	end if;
END;
/

ALTER TRIGGER "T_REGION_ID" ENABLE;

CREATE TABLE "MKB" (
	"MKB_ID"		NUMBER(10),
	"MKB_NAME"		VARCHAR2(10),
	"DIAGNSIS_NAME" VARCHAR2(40),
	PRIMARY KEY("MKB_ID")
);

CREATE SEQUENCE S_MKB
START WITH 1
INCREMENT BY 1
CACHE 10;

CREATE OR REPLACE TRIGGER T_MKB_ID
BEFORE INSERT
ON MKB
REFERENCING NEW AS NEW
FOR EACH ROW
BEGIN
	if(:new.MKB_ID is null) then
	SELECT S_MKB.nextval
	INTO :new.MKB_ID
	FROM dual;
	end if;
END;
/

ALTER TRIGGER "T_MKB_ID" ENABLE;

CREATE TABLE "DATE_OF_REGISTRATION" (
	"REG_ID" 		NUMBER(10),
	"PACIENT_ID" 	NUMBER(10),
	"MKB_ID" 		NUMBER(10),
	"DATE_REG" 		DATE DEFAULT NULL,
	"DATE_OUT_REG"  DATE DEFAULT NULL,
	PRIMARY KEY("REG_ID"),
	CONSTRAINT "PACIENT_ID_FK_1" FOREIGN KEY ("PACIENT_ID")
		REFERENCES "PACIENT" ("PACIENT_ID"),
	CONSTRAINT "MKB_ID_FK_2" FOREIGN KEY ("MKB_ID")
		REFERENCES "MKB" ("MKB_ID")
);

CREATE SEQUENCE S_DATE_OF_REG
START WITH 1
INCREMENT BY 1
CACHE 10;

CREATE OR REPLACE TRIGGER T_DATE_OF_REG_ID
BEFORE INSERT
ON DATE_OF_REGISTRATION
REFERENCING NEW AS NEW
FOR EACH ROW
BEGIN
	if(:new.REG_ID is null) then
	SELECT S_DATE_OF_REG.nextval
	INTO :new.REG_ID
	FROM dual;
	end if;
END;
/

ALTER TRIGGER "T_DATE_OF_REG_ID" ENABLE;

CREATE TABLE "ADDRESS" (
	"ADDR_ID" 		NUMBER(10),
	"REGION_ID" 	NUMBER(10) NOT NULL,
	"PACIENT_ID"	NUMBER(10) NOT NULL,
	"STREET_NAME"	VARCHAR2(30) NOT NULL,
	PRIMARY KEY("ADDR_ID"),
	CONSTRAINT "REGION_ID_FK_1" FOREIGN KEY ("REGION_ID")
		REFERENCES "REGION" ("REGION_ID")
	CONSTRAINT "PACIENT_ID_FK_1" FOREIGN KEY ("PACIENT_ID")
		REFERENCES "PACIENT" ("PACIENT_ID")
);

CREATE SEQUENCE S_ADDRESS
START WITH 1
INCREMENT BY 1
CACHE 10;

CREATE OR REPLACE TRIGGER T_ADDRESS_ID
BEFORE INSERT
ON ADDRESS
REFERENCING NEW AS NEW
FOR EACH ROW
BEGIN
	if(:new.ADDR_ID is null) then
	SELECT S_ADDRESS.nextval
	INTO :new.ADDR_ID
	FROM dual;
	end if;
END;
/

ALTER TRIGGER "T_ADDRESS_ID" ENABLE;
